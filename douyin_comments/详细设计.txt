
【问题定义】
    概述：
        实现自动化dy私信，希望能够对给定视频类目下所有评论人员进行私信发送指定的信息。
    需求分析：
        利用ADB工具模拟操作手机dy软件，或安卓模拟器上的dy软件，能同时操作多个登入不同账号的dy软件。
        登录过程人为完成。
        ??如何给定视频分类信息？
        ??如何给定指定信息？通过文件修改指定信息，修改后即时生效或触发生效？
        ??先实现操控单台手机的dy软件自动评论，后续新增多个手机操控。
        人机交互功能，简单命令，开始，暂停，重载配置，停止等。
        日志信息跟踪保存。
        评论记录跟踪保存。

【设计考虑】
    功能设计考虑：
        依赖：
            ADB工具，Python语言，手机或模拟器
        使用状态，运行阶段：
            Idle: 准备，认为搭建环境，准备终端，登录dy，设置好视频分类信息配置，要发送的评论信息。
            Ready: 同步配置信息，分配终端，打开dy软件。
            Run: 运行状态，对多个终端操作，搜索评论对象，发送私信，注意避免重复。
            Pause: 暂停操作，保存当前数据信息。
            Stop: 停止，存储日志信息。
            Sync: 从配置文件同步最新的视频类型，私信信息，之后按新的配置执行操作。
        记录信息
            已遍历视频id，防止多个终端重复遍历视频
            用户信息:
                抖音号
                发送信息组列表，记录该用户已经被发送了哪些类型信息，同时也防止重复发送
        视频分类与定位
            分类: 分类关键词
            定位: 点击主界面左上角发现按钮 -> 输入关键词 -> 搜索等待 -> 点击视频栏 -> 点击第一个视频 -> 常规私信操作
        常规私信操作流程
            视频界面 -> 评论 -> 遍历+私信 -> 下一个视频
        模块间通信方式
            类，接口访问
        系统状态变动触发类型
            用户cli输入
            执行环境异常
        多线程操作ADB
            每个线程通过终端名称区分操作的终端
            ex: adb -s "terminal-name" pull /sdcard/ui.xml
        资源冲突
            adb操作命令: 在操作adb命令的地方处做一个同步锁
            日志存储: 同步锁
            配置读取: 同步锁
    质量属性考虑：
        性能，容量，可用性，易用性，可修改性，可测试性，安全性
    配置文件格式
        可以注释
        可以表示层级结构
        可以直观看懂，手动配置简单
        暂时选择yaml

【主要结构】
    common 公共操作模块
    debug 调试模块
    douyin_main 状态管理模块，主模块，顶层管理
    douyin_sub 子管理模块，用于创建线程，与主线程通信接口
    douyin_cli 人机交互模块
        暂时不用，简单解析在主模块里判断即可
    douyin_log 运行日志跟踪与信息记录模块
        根据日志类型，将日志格式化存储在文件里
    douyin_ctrl 终端操控模块，xml原始数据获取，动作模拟
        基于ADB命令封装操作接口
    douyin_xml xml信息提取模块
    
【系统流】
    启动过程：
        python douyin_main.py start
        读取配置信息
        根据终端数创建线程，并分配任务
        状态机循环
    线程状态表：
        Ready: 启动，开始，准备
        Run: 正常运行
        Pause: 碰到异常情况等待处理
    dy软件弹出通知异常：
        检查到当前页面不是期待的情况时，如果无法处理，弹出异常，并等待
    主程序状态表：
        S1: Idle
            准备环境: 
                对每个终端执行下面操作：
                    安装dy软件，打开登录
                    关闭一些不必要的通知
                    安装ADB输入法
                    安装ADB驱动
                在PC端对要操作的每个视频类型进行用户文件配置:
                    视频关键词
                    终端个数
                    私信信息
            启动进程:
                python douyin_main.py start
            转S2
        S2: Ready
            初始化所有模块
            读取配置信息
            为每组配置分配终端
            更据终端数创建线程，每个线程执行:
                同步配置信息
                打开dy软件
            转S4
        S3: Sync
            读取配置信息到配置信息变量列表
            回到上一个状态
        S4: Run
            主线程:
                循环检测用户输入信息:
                    pause: 发送所有线程暂停，等待所有线程暂停动作完成，给出提示，转S5
                    stop: 发送所有线程停止，等待所有线程停止动作完成，给出提示，转S6
            子线程:
                T1
                搜索定位视频，提取视频号（可能是下拉，或重新定位）
                判断是否符合条件:
                    视频类似是否符合条件
                    之前没有操作过，没有对应类别的日志记录
                    if 符合: 开始操作，转T2
                    else: 下一条视频，转T1
                T2
                点击评论
                搜索每个用户，深度n搜索，全搜索，常规搜索（有在xml里显示的发送私信）
                if 收到暂停指令: 保存当前环境信息到本线程，循环等待运行指令
                if 收到停止指令: 记录信息，回到视频主界面，退出线程
                记录用户信息
                回到视频主界面
        S5: Pause
        S6: Stop
【数据结构】
    坐标定位类型
        主页视频搜索
        主页视频点击进入
        视频也暂停、播放
        评论
        用户遍历（复杂）
        返回
        更多
        私信发送
【算法描述】
    遍历用户算法(遍历深度 1)
        S1) 点击评论前获取评论数, 或点击后找出 "xxx条评论"的坐标和评论数
        S2) 获取第一级第1个评论者头像坐标, 记录名称, 插入列表
        S3) 进行发送私信操作
        S4) 发送完成, 回退到评论列表
        S5) 控件固定操作, 使控件空闲下来才能抓到控件信息
        S6) 重新在当前控件信息理定位到当前位置坐标, 搜索当前控件信息的下一个评论对象
        S7) 如果搜索到则转S3, 并把名称插入列表
            如果未搜索到且搜索到"暂时没有更多了", 则转S20
            如果未搜索到且没有"暂时没有更多了"的信息, 则转S8
        S8) 进行上滑操作, 重新获取控件信息, 
        S9) 在新控件信息中定位最近一次的用户名称, 顺延找到到下一个评论对象, 然后转S3
        S20)该视频搜索完毕, 继续下一个视频
        
【接口设计】
    人机交互命令：
        python douyin_main.py start
            启动进程
        exit 强制退出
        stop 停止退出
        pause 暂停
        resume [terminal-name] 对所有或指定终端进行执行线程恢复操作
        sync [terminal-name] 对所有或指定终端同步配置操作
    配置文件：
        配置配置格式: 视频类型关键词 终端数 遍历模式 最大用户数
            vedio-key: "中国最美公路"
            device-count: 1
            trave-mode: "L1"
            user-count: -1
    存储日志：
        用户存储日志格式:
            user_id: "99888"
            op_status: "done"
            vedio_id_list: ["12345678", "xxx"]
        视频存储日志格式:
            verio_id: "12345678"
            op_status: "done"
            user_id_list: ["99888", "xxx"]
        运行日志格式:
            time xxx xxx xxx ...
【其他考虑】
    配置与约束
    测试考虑
    专利考虑
    产品发展计划

